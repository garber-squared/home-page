---
import type { Form as Props } from '~/types';
import Button from '~/components/ui/Button.astro';

const { inputs, textarea, disclaimer, button = 'Contact us', description = '' } = Astro.props;
---

<form id="contact-form" accept-charset="UTF-8">
  {
  inputs &&
      inputs.map(
        ({ type = 'text', name, label = '', autocomplete = 'on', placeholder = '' }) =>
          name && (
        <div class="mb-6">
    {label && (
    <label for={name} class="block text-sm font-medium">
      {label}
    </label>
    )}
    <input
      type={type}
      name={name}
      id={name}
      autocomplete={autocomplete}
      placeholder={placeholder}
      class="py-3 px-4 block w-full text-md rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900"
      required
    />
  </div>
  )
      )
  }

  {
  textarea && (
  <div>
    <label for="textarea" class="block text-sm font-medium">
      {textarea.label}
    </label>
    <textarea
      id="textarea"
      name={textarea.name ? textarea.name : 'message'}
      rows={textarea.rows ? textarea.rows : 4}
      placeholder={textarea.placeholder}
      class="py-3 px-4 block w-full text-md rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900"
      required
    />
  </div>
  )
  }

  {
  disclaimer && (
  <div class="mt-3 flex items-start">
    <div class="flex mt-0.5">
      <input
        id="disclaimer"
        name="disclaimer"
        type="checkbox"
        class="cursor-pointer mt-1 py-3 px-4 block w-full text-md rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900"
        required
      />
    </div>
    <div class="ml-3">
      <label for="disclaimer" class="cursor-pointer select-none text-sm text-gray-600 dark:text-gray-400">
        {disclaimer.label}
      </label>
    </div>
  </div>
  )
  }

  {
  button && (

  <div id="form-status" class="hidden text-sm text-green-600"></div>
  <div id="form-error" class="hidden text-sm text-red-600"></div>
  <div class="mt-10 grid">
    <Button variant="primary" type="submit">
      {button}
    </Button>
  </div>
  )
  }

  {
  description && (
  <div class="mt-3 text-center">
    <p class="text-sm text-gray-600 dark:text-gray-400">{description}</p>
  </div>
  )
  }
</form>

<script type="module">
  function handleSubmit(event) {
    event.preventDefault();

    const form = document.getElementById('contact-form');
    const status = document.getElementById('form-status');
    const error = document.getElementById('form-error');

    status.classList.add('hidden');
    error.classList.add('hidden');

    const formData = new FormData(form);

    fetch('/api/contact', {
      method: 'POST',
      body: new URLSearchParams(formData),
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
    })
      .then((res) => {
        if (!res.ok) throw new Error(`Status ${res.status}`);
        form.reset();
        status.textContent = '✅ Message sent! We’ll be in touch shortly.';
        status.classList.remove('hidden');
      })
      .catch((err) => {
        console.error(err);
        error.textContent = '⚠️ Something went wrong. Please try again.';
        error.classList.remove('hidden');
      });
  }

  window.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form');
    if (form) {
      form.addEventListener('submit', handleSubmit);
    }
  });
</script>

